<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Falling Sand</title>
</head>

<body>
	<h1>Falling Sand</h1>
	<canvas id="canvas" width="800" height="800" style="border: 1px solid black"></canvas>
	
<script>
	var canvas, context;
  	canvas = document.getElementById("canvas");
  	context = canvas.getContext("2d");
	
	const SAND_MAX = 40;
	const Height_Max = 200;
	
	var SandGreenImage = new Image;
	SandGreenImage.src = "SandGreen.png";
	
	var sandArray = [];
	
	class ClassSand{
		constructor(X){
			this.velY = -3;
			this.X = X;
			this.Y = 0;
			this.image = SandGreenImage;
		}
		move(){
			this.Y = this.Y + this.velY;
			if (this.Y > Height_Max){
				this.velY = 0;
			}
		}
	}
	
	window.onload = function() {
		console.log("Start");
		for ( let i = 0; i < SAND_MAX; i++){
			
			sandArray[i] = new ClassSand(5*Math.floor(Math.random()*30) + 100)
			console.log("i: "+i+" X: "+sandArray[i].X);
			_SandFall();
			_DrawImage();
			
			
			
			//for (let j = 0; j < sandArray.length-1; j++){
			//	sandArray[j].move();
			//	console.log("ArrayMax: "+sandArray.length+"Array: "+j+" Y value: "+sandArray[j].Y);
			//}
			//drawImage();
		}
	}
	
	function _SandFall(){
		for ( let i = 0; i < sandArray.length; i++){
			console.log("SandFall, X: "+sandArray[i].X+" Y: "+sandArray[i].Y);
			sandArray[i].Y -= sandArray[i].velY;
			
			if (sandArray[i] > Height_Max){
				sandArray[i].Y = Height_Max;
				sandArray[i].velY = 0;
			}
		}
	}
	function _DrawImage(){
		console.log("Draw");
		context.fillStyle = 'lightGrey';
		context.fillRect(0,0, canvas.width, canvas.height);
		for (let i=0; i < sandArray.length - 1; i++){
  			context.drawImage(SandGreenImage, sandArray[i].X, sandArray[i].Y);
		}
	}
	
</script>
</body>
</html>
